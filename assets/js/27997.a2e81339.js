"use strict";(self.webpackChunkelemental_selenium=self.webpackChunkelemental_selenium||[]).push([[27997],{27997:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var s=r(74848),t=r(28453);const i={},o=void 0,a={id:"forgot-password/_ruby",title:"_ruby",description:"Example",source:"@site/tips/43-forgot-password/_ruby.mdx",sourceDirName:"43-forgot-password",slug:"/forgot-password/_ruby",permalink:"/tips/forgot-password/_ruby",draft:!1,unlisted:!1,editUrl:"https://github.com/saucelabs/elemental-next/blob/main/frontend/tips/43-forgot-password/_ruby.mdx",tags:[],version:"current",lastUpdatedBy:"renovate[bot]",lastUpdatedAt:1727078715e3,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"How to Run a Test on Multiple Browsers, In Parallel",permalink:"/tips/42-one-test-multiple-browsers-parallel"},next:{title:"How to Test Forgot Password",permalink:"/tips/43-forgot-password"}},d={},l=[{value:"Example",id:"example",level:2},{value:"Expected Behavior",id:"expected-behavior",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.p,{children:["First let's include our dependent libraries (e.g., ",(0,s.jsx)(n.code,{children:"selenium-webdriver"})," to control the browser, ",(0,s.jsx)(n.code,{children:"rspec/expectations"}),"\nand ",(0,s.jsx)(n.code,{children:"RSpec::Matchers"})," for assertions, and ",(0,s.jsx)(n.a,{href:"https://github.com/dcparker/ruby-gmail",children:(0,s.jsx)(n.code,{children:"gmail"})})," to access a Gmail account headless) and create some\nsimple ",(0,s.jsx)(n.code,{children:"setup"}),", ",(0,s.jsx)(n.code,{children:"teardown"}),", and ",(0,s.jsx)(n.code,{children:"run"})," methods to handle our test configuration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ruby",children:"# filename: forgot_password.rb\n\nrequire 'selenium-webdriver'\nrequire 'rspec-expectations'\ninclude RSpec::Matchers\nrequire 'gmail'\n\ndef setup\n  @driver = Selenium::WebDriver.for :firefox\nend\n\ndef teardown\n  @driver.quit\nend\n\ndef run\n  setup\n  yield\n  teardown\nend\n"})}),"\n",(0,s.jsx)(n.p,{children:"Once triggered, the forgot password e-mail should be received quickly. But since we're dealing with a third-party\nprovider we'll want to build in some resiliency. So let's create a simple mechanism to retry our email lookup a\nconfigurable number of times and make it wait a handful of seconds in-between each attempt."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ruby",children:"def try(number_of_times)\n  count = 0 ; item_of_interest = nil\n  until item_of_interest != nil || count == number_of_times\n    item_of_interest = yield\n    sleep 10\n    count += 1\n  end\nend\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When calling this method, we will need to specify an integer for the number of times that we'd like to retry an\naction. And we'll specify the action by passing it to the method through the use of ",(0,s.jsx)(n.code,{children:"yield"})," (which enables us to\npass a block of code into the method just like we're doing for the ",(0,s.jsx)(n.code,{children:"run"})," method). Between each attempt, the\nmethod will wait for ",(0,s.jsx)(n.code,{children:"10"})," seconds."]}),"\n",(0,s.jsx)(n.p,{children:"Now let's wire up our test."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ruby",children:"run do\n  @driver.get 'https://the-internet.herokuapp.com/forgot_password'\n  @driver.find_element(id: 'email').send_keys(ENV['EMAIL_USERNAME'])\n  @driver.find_element(id: 'form_submit').click\n\n  gmail = Gmail.new(ENV['EMAIL_USERNAME'], ENV['EMAIL_PASSWORD'])\n  try(6) { @email = gmail.inbox.emails(:unread, from: 'no-reply@the-internet.herokuapp.com').last }\n  message_body = @email.message.body.raw_source\n\n  url =  message_body.scan(/https?:\\/\\/[\\S]+/).last\n  username = message_body.scan(/username: (.*)$/)[0][0].strip\n  password = message_body.scan(/password: (.*)$/)[0][0].strip\n\n  @driver.get url\n  @driver.find_element(id: 'username').send_keys username\n  @driver.find_element(id: 'password').send_keys password\n  @driver.find_element(id: 'login').submit\n  expect(@driver.current_url.include?('/secure')).to eql true\nend\n"})}),"\n",(0,s.jsx)(n.p,{children:"We initiate the forgot password workflow by loading the page with the forgot password form, providing an email\naddress, and submitting the form. We then access the Gmail account headless. Notice that the username and password\ncredentials are specified with environment variables, but you could just as easily hard-code your credentials here."}),"\n",(0,s.jsxs)(n.p,{children:["After connecting we attempt to retrieve the message body. Here is where we employ our ",(0,s.jsx)(n.code,{children:"try"})," method (retrying the\nlookup action up to ",(0,s.jsx)(n.code,{children:"6"})," times). If the inbox lookup doesn't find what it's looking for, it will return ",(0,s.jsx)(n.code,{children:"nil"}),",\nwhich will trigger the ",(0,s.jsx)(n.code,{children:"try"})," loop to run again after waiting ",(0,s.jsx)(n.code,{children:"10"})," seconds. If it finds what we're looking for,\nthen the loop will stop running and the test will proceed."]}),"\n",(0,s.jsx)(n.p,{children:"Once the forgot password email is found we parse it's body with regular expressions to find the URL & user\ncredentials in it. We then put these values to use with our browser session (which is still active) by visiting\nthe URL and logging in. Once done we assert that login was successful by checking to see if we gained access to a\nsecure part of the site."}),"\n",(0,s.jsx)(n.h2,{id:"expected-behavior",children:"Expected Behavior"}),"\n",(0,s.jsxs)(n.p,{children:["If you save this file and run it (e.g., ",(0,s.jsx)(n.code,{children:"ruby forgot_password.rb"})," from the command-line) here is what will happen:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Open the browser"}),"\n",(0,s.jsx)(n.li,{children:"Visit the page and initiate the forgot password workflow"}),"\n",(0,s.jsx)(n.li,{children:"Headless access Gmail and retrieve the email message body"}),"\n",(0,s.jsx)(n.li,{children:"Parse the message body for user credentials"}),"\n",(0,s.jsx)(n.li,{children:"Visit the site and login with the user credentials"}),"\n",(0,s.jsx)(n.li,{children:"Check that login was successful"}),"\n",(0,s.jsx)(n.li,{children:"Close the browser"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["NOTE: When running this script you can pass in the Gmail account username and password at runtime\n(e.g., ",(0,s.jsx)(n.code,{children:"EMAIL_USERNAME=youremail@gmail.com EMAIL_PASSWORD=yourpassword ruby forgot_password.rb"}),")."]})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:["Your forgot password workflow might be different, so adapt as needed. And if you have other things in an e-mail\nmessage body that you need to parse for and aren't sure of the regular expressions you need -- give\n",(0,s.jsx)(n.a,{href:"http://rubular.com/",children:"Rubular"})," a try."]}),"\n",(0,s.jsx)(n.p,{children:"Happy Testing!"})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);