"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9464],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=c(n),h=i,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||r;return n?a.createElement(m,s(s({ref:t},u),{},{components:n})):a.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[p]="string"==typeof e?e:i,s[1]=o;for(var c=2;c<r;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1785:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const r={title:"Retry Test Actions",id:"10-retry-test-actions-ruby",contentUrl:"docs/retry-test-actions-ruby/10-retry-test-actions-ruby",sidebar_label:"Ruby",text:"We all write tests with the best intention of having them pass and, when they fail, to reveal legitimate issues in the application we're testing. But that's not always easy to accomplish. Especially when your application is dependent upon third-party service providers (e.g. payment providers, social networks, etc).",number:10,hide_table_of_contents:!0,publish_date:new Date("2013-07-30T00:00:00.000Z"),last_update:{date:new Date("2023-02-27T00:00:00.000Z")},tags:["reliability"],level:2,category:["troubleshooting"],language:"ruby"},s="Retrying Test Actions",o={unversionedId:"retry-test-actions-ruby/10-retry-test-actions-ruby",id:"retry-test-actions-ruby/10-retry-test-actions-ruby",title:"Retry Test Actions",description:"Intro",source:"@site/docs/10-retry-test-actions-ruby/ruby.mdx",sourceDirName:"10-retry-test-actions-ruby",slug:"/retry-test-actions-ruby/10-retry-test-actions-ruby",permalink:"/docs/retry-test-actions-ruby/10-retry-test-actions-ruby",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/10-retry-test-actions-ruby/ruby.mdx",tags:[{label:"reliability",permalink:"/docs/tags/reliability"}],version:"current",lastUpdatedBy:"Paloma Oliveira",lastUpdatedAt:1677456e3,formattedLastUpdatedAt:"Feb 27, 2023",frontMatter:{title:"Retry Test Actions",id:"10-retry-test-actions-ruby",contentUrl:"docs/retry-test-actions-ruby/10-retry-test-actions-ruby",sidebar_label:"Ruby",text:"We all write tests with the best intention of having them pass and, when they fail, to reveal legitimate issues in the application we're testing. But that's not always easy to accomplish. Especially when your application is dependent upon third-party service providers (e.g. payment providers, social networks, etc).",number:10,hide_table_of_contents:!0,publish_date:"2013-07-30T00:00:00.000Z",last_update:{date:"2023-02-27T00:00:00.000Z"},tags:["reliability"],level:2,category:["troubleshooting"],language:"ruby"},sidebar:"tutorialSidebar",previous:{title:"Ruby",permalink:"/docs/use-a-base-page-object/9-use-a-base-page-object-ruby"},next:{title:"Ruby",permalink:"/docs/build-an-interactive-prompt/11-build-an-interactive-prompt-ruby"}},l={},c=[{value:"Intro",id:"intro",level:2},{value:"A Solution",id:"a-solution",level:2},{value:"Example",id:"example",level:2},{value:"Expected Behavior",id:"expected-behavior",level:2},{value:"Summary",id:"summary",level:2},{value:"About The Author",id:"about-the-author",level:2}],u={toc:c},p="wrapper";function d(e){let{components:t,...r}=e;return(0,i.kt)(p,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"retrying-test-actions"},"Retrying Test Actions"),(0,i.kt)("h2",{id:"intro"},"Intro"),(0,i.kt)("p",null,"We all write tests with the best intention of having them pass and, when they fail, to reveal legitimate issues in the application we're testing. But that's not always easy to accomplish. Especially when your application is dependent upon third-party service providers (e.g. payment providers, social networks, etc)."),(0,i.kt)("h2",{id:"a-solution"},"A Solution"),(0,i.kt)("p",null,"Rather than have your tests fail intermittently for reasons that don't actually reflect an issue in your application (or that are really difficult to track down), we'd like to trigger a context specific retry for a specific set of actions (rather than the whole test) that will back-off after a few attempts."),(0,i.kt)("p",null,"If it finds what it needs, the tests passes. If it doesn't, the test fails -- and you know you have a legitimate problem on your hands."),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)("p",null,"The example application is a page that displays a notification message at the top of the page. It will either say ",(0,i.kt)("strong",{parentName:"p"},"Action successful")," or ",(0,i.kt)("strong",{parentName:"p"},"Action unsuccessful, please try again"),". You can see it ",(0,i.kt)("a",{parentName:"p",href:"http://the-internet.herokuapp.com/notification_message"},"here"),"."),(0,i.kt)("p",null,"Our goal in this example is verify an ",(0,i.kt)("strong",{parentName:"p"},"Action successful")," message."),(0,i.kt)("p",null,"The beginning of our test script starts off simply with accessing our libraries (Selenium and RSpec) and creating our setup, teardown, and run actions."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'selenium-webdriver'\nrequire 'rspec/expectations'\n\ndef setup\n  @driver = Selenium::WebDriver.for :firefox\nend\n\ndef teardown\n  @driver.quit\nend\n\ndef run\n  setup\n  yield\n  teardown\nend\n")),(0,i.kt)("p",null,"A first pass at this example would look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ruby"},"run {\n  @driver.get 'http://the-internet.herokuapp.com/notification_message'\n  notification_message = @driver.find_element(id: 'flash').text\n  notification_message =~ /Action successful/\n}\n")),(0,i.kt)("p",null,"The problem with this approach is that it will fail intermittently because the page's notification message could very well be something else. But the next time you load it, it could be the correct thing."),(0,i.kt)("p",null,"Perhaps something like this would be better suited:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ruby"},"def get_notification_message\n  @notification_message = @driver.find_element(id: 'flash').text\nend\n\ndef retry_if_notification_message_contains(fail_message)\n  count = 0\n  yield\n  until !@notification_message.include? fail_message || count == 3\n    yield\n    count =+ 1\n  end\nend\n\nrun {\n  retry_if_notification_message_contains 'please try again' do\n    @driver.get 'http://the-internet.herokuapp.com/notification_message'\n    get_notification_message\n  end\n  @notification_message =~ /Action successful/\n}\n")),(0,i.kt)("p",null,"In this approach we have abstracted out the text grab of the notification message into a method which sets what it finds into an instance variable. And we've added a new method called ",(0,i.kt)("inlineCode",{parentName:"p"},"retry_if_notification_message_contains")," that accepts an argument of ",(0,i.kt)("inlineCode",{parentName:"p"},"fail_message"),". In it we accept a yield in 2 places and have constructed a simple loop that runs 3 times or until the notification message does not match the ",(0,i.kt)("inlineCode",{parentName:"p"},"fail_message"),", whichever comes first. And the yields will execute whatever code is passed both before and during the loop."),(0,i.kt)("p",null,"In the run block we pass our navigation and text grab actions as a block into ",(0,i.kt)("inlineCode",{parentName:"p"},"retry_if_notification_message_contains"),", passing the failure message of ",(0,i.kt)("strong",{parentName:"p"},"please try again")," as the argument for ",(0,i.kt)("inlineCode",{parentName:"p"},"fail_message")," to receive."),(0,i.kt)("p",null,"And we top everything off with an assertion."),(0,i.kt)("h2",{id:"expected-behavior"},"Expected Behavior"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Load the page"),(0,i.kt)("li",{parentName:"ul"},"Grab the notification message text"),(0,i.kt)("li",{parentName:"ul"},"Compare it to the failure message"),(0,i.kt)("li",{parentName:"ul"},"If it matches, retry"),(0,i.kt)("li",{parentName:"ul"},"If 3 retries attempted, end loop, and fail test"),(0,i.kt)("li",{parentName:"ul"},"If it doesn't match, pass the test")),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"With this approach there may be a concern that we could be obfuscating a real issue that could bubble up to our users. That's why it is important to use this approach sparingly, and on issues you more or less understand (e.g. a third-party test environment having one-off service blips, or expensive tests that involve sharing something to a third-party and checking to see that it appeared)."),(0,i.kt)("p",null,"Hopefully this example will help you build a more resilient and relevant set of tests."),(0,i.kt)("p",null,"Happy Testing!"),(0,i.kt)("h2",{id:"about-the-author"},"About The Author"),(0,i.kt)("p",null,"Dave Haeffner is the original writer of Elemental Selenium -- a free, once weekly Selenium tip newsletter that's read by thousands of testing professionals. He also created and maintains the-internet (an open-source web app that's perfect for writing automated tests against)."),(0,i.kt)("p",null,"Dave has helped numerous companies successfully implement automated acceptance testing; including The Motley Fool, ManTech International, Sittercity, and Animoto. He is also an active member of the Selenium project and has spoken at numerous conferences and meetups around the world about automated acceptance testing."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Dave Haeffner profile picture",src:n(9417).Z+"#author-img",title:"a title",width:"280",height:"280"})))}d.isMDXComponent=!0},9417:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/dave-haeffner-4b48111a5789c5e16142754eb2f51920.jpeg"}}]);