"use strict";(self.webpackChunkelemental_selenium=self.webpackChunkelemental_selenium||[]).push([[6660],{64279:(e,r,n)=>{n.r(r),n.d(r,{contentTitle:()=>o,default:()=>d,frontMatter:()=>i,toc:()=>l});var s=n(74848),t=n(28453);const i={},o=void 0,l=[{value:"A Solution",id:"a-solution",level:2},{value:"Example",id:"example",level:2},{value:"Expected Behavior",id:"expected-behavior",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const r={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"a-solution",children:"A Solution"}),"\n",(0,s.jsx)(r.p,{children:"The tried and true approach that Selenium Committers and Practitioners recommend is to use a proxy server. With it, you will be able to watch and manipulate network traffic to and from the application you're testing. Thus giving you access to a whole host of functionality that isn't available otherwise."}),"\n",(0,s.jsxs)(r.p,{children:["Let's step through an example using ",(0,s.jsx)(r.a,{href:"http://bmp.lightbody.net/",children:"BrowserMob Proxy"}),"."]}),"\n",(0,s.jsx)(r.h2,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(r.p,{children:["First we need to download a copy of ",(0,s.jsx)(r.a,{href:"http://bmp.lightbody.net/",children:"BrowserMob Proxy"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Next we'll create a script and pull in our requisite libraries (e.g., ",(0,s.jsx)(r.code,{children:"selenium-webdriver"})," to drive the browser, ",(0,s.jsx)(r.code,{children:"rspec/expectations"})," and it's matchers for our assertion, and the ",(0,s.jsx)(r.a,{href:"https://github.com/jarib/browsermob-proxy-rb",children:(0,s.jsx)(r.code,{children:"browsermob/proxy"})})," library to control the proxy server)."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"# filename: status_codes.rb\n\nrequire 'selenium-webdriver'\nrequire 'rspec/expectations'\ninclude RSpec::Matchers\nrequire 'browsermob/proxy'\n"})}),"\n",(0,s.jsx)(r.p,{children:"Now let's create a method to prepare the proxy for use with Selenium. In it we start the proxy server, configure a browser profile to use it (for Firefox in this case), and return the profile object."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"def configure_proxy\n  server = BrowserMob::Proxy::Server.new(\n    File.join(Dir.pwd, 'browsermob-proxy-2.0.0/bin/browsermob-proxy'))\n  @proxy = server.start.create_proxy\n  profile = Selenium::WebDriver::Firefox::Profile.new\n  profile.proxy = @proxy.selenium_proxy\n  profile\nend\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Next we wire up some simple ",(0,s.jsx)(r.code,{children:"setup"}),", ",(0,s.jsx)(r.code,{children:"teardown"}),", and ",(0,s.jsx)(r.code,{children:"run"})," methods to handle our test configuration."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"def setup\n  @driver = Selenium::WebDriver.for :firefox, profile: configure_proxy\nend\n\ndef teardown\n  @driver.quit\n  @proxy.close\nend\n\ndef run\n  setup\n  yield\n  teardown\nend\n"})}),"\n",(0,s.jsxs)(r.p,{children:["In ",(0,s.jsx)(r.code,{children:"setup"})," we use the ",(0,s.jsx)(r.code,{children:"configure_proxy"})," method when specifying the profile object. And we close the proxy in ",(0,s.jsx)(r.code,{children:"teardown"})," (after quitting the Selenium session)."]}),"\n",(0,s.jsxs)(r.p,{children:["Now let's create a helper method to pull the status code out of the browser's ",(0,s.jsx)(r.a,{href:"http://www.softwareishard.com/blog/har-12-spec/",children:"HTTP Archive"})," (a.k.a. HAR) when an action is performed on the page."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"def retrieve_status_code\n  @proxy.new_har\n  yield\n  @proxy.har.entries.first.response.status\nend\n"})}),"\n",(0,s.jsx)(r.p,{children:"Now we're ready to wire up our test."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"run do\n  status_code = retrieve_status_code do\n    @driver.get 'http://the-internet.herokuapp.com/status_codes/404'\n  end\n\n  expect(status_code).to eql 404\nend\n"})}),"\n",(0,s.jsxs)(r.p,{children:["When visiting the page we are passing the Selenium command to the ",(0,s.jsx)(r.code,{children:"retrieve_status_code"})," method which returns the HTTP response code. We store this in a ",(0,s.jsx)(r.code,{children:"status_code"})," variable and use it to check that the response code is what we expect (",(0,s.jsx)(r.code,{children:"404"}),")."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"NOTE:"})," If you get an error when running your test, be sure to append ",(0,s.jsx)(r.code,{children:"log: true"})," when creating an instance of ",(0,s.jsx)(r.code,{children:"Browsermob::Proxy::Server"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ruby",children:"  server = BrowserMob::Proxy::Server.new(\n    File.join(Dir.pwd, 'browsermob-proxy-2.0.0/bin/browsermob-proxy'), log: true)\n"})}),"\n",(0,s.jsx)(r.p,{children:"Now when you run your test, you will see more detailed information as to why the server was unable to start."}),"\n",(0,s.jsx)(r.h2,{id:"expected-behavior",children:"Expected Behavior"}),"\n",(0,s.jsxs)(r.p,{children:["If you save this file and run it (e.g., ",(0,s.jsx)(r.code,{children:"ruby status_codes.rb"})," from the command-line) here is what will happen:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Proxy server starts"}),"\n",(0,s.jsx)(r.li,{children:"Proxy server session created"}),"\n",(0,s.jsx)(r.li,{children:"Browser opens"}),"\n",(0,s.jsx)(r.li,{children:"Visit the URL"}),"\n",(0,s.jsx)(r.li,{children:"Retrieve the HTTP Status Code from loading the page"}),"\n",(0,s.jsx)(r.li,{children:"Check that the status code is what was expected"}),"\n",(0,s.jsx)(r.li,{children:"Browser closes"}),"\n",(0,s.jsx)(r.li,{children:"Proxy session closes"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(r.p,{children:["This tip was inspired by ",(0,s.jsx)(r.a,{href:"https://twitter.com/jimevansmusic",children:"Jim Evans'"})," multi-part blog post series on doing the same thing in C# with Fiddler (",(0,s.jsx)(r.a,{href:"http://jimevansmusic.blogspot.com/2013/08/implementing-webdriver-http-status.html",children:"1"}),", ",(0,s.jsx)(r.a,{href:"http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in.html",children:"2"}),", ",(0,s.jsx)(r.a,{href:"http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in_17.html",children:"3"}),") which was in response to ",(0,s.jsx)(r.a,{href:"https://code.google.com/p/selenium/issues/detail?id=141",children:"Selenium Issue 141"}),". Thanks Jim!"]}),"\n",(0,s.jsx)(r.p,{children:"Happy Testing!"})]})}function d(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);